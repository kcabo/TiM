## 開発メモ

### 機能要件
- アカウント追加を楽にする
- DB10000行制限対策
- 一日のメニュー数拡大
- 矢印間違えて押しちゃう
- 自分に！しか送られないことを周知
- マニュアル整備（改行できるとかしらんでしょっていう）
- タイム一覧見やすく メニューがわかりにくい？
- EDITとはなんぞや →日本語にするぞ
- User.roleにVIEWERを設ければ応答はするけど編集はできない人、みたいなのが作れる（引退したらそうするか？）
- メニュー削除時に削除予定のレコード数も通知する
- ボタン押したらフォームに入力される
- noun のクレジットどっかに書く
- hiredis使う
- エンドポイントをwebhookに変更
- DestructiveUpdateが必要なくなったけど、この代替を理解しているか


### データベース(ローカルの話)
- Postgresのバージョンは12.4
- timのロールを生成 パスワードも適当に設定 `alter role login`とかでログイン権限付与できる
- ```create database tim encoding = UTF8 LC_COLLATE = 'en_US.UTF-8' LC_CTYPE = 'en_US.UTF-8' template = template0``` でデータベースを生成
- エンコーディング、ロケールの値はそれぞれherokuで設定されるのと同値
- `postgresql://tim:0000@localhost:5432/tim`でアクセスする。
- テーブル情報をダンプするやり方がある。そのSQLを発行すればcreate_all()実行しなくていい
- 旧データをCSVにダンプして、ローカルからそのデータを新DBに読み込ませることができるはず
- 文字列の前にE（小文字でもOK）を入力することで改行コードを挿入できる。
> INSERT INTO target_table (target_col) VALUES (E'foo\nbar');
> キーボードから入力できない文字を文字列の中で表したい場合や、特別な意味を持つ文字を入力したい場合、PostgreSQL ではエスケープ文字列を使用します。エスケープ文字列はシングルクォーテーションの前に E または e を記述します。
```
¥b      バックスペース文字
¥f      改ページ
¥n      改行
¥r      復帰改行
¥t      タブ文字
¥o      8進数バイト値
¥xh     16進数バイト値
¥uxxxx  16もしくは32ビットの16進数 Unicode 文字値
```

- ハイフンとアットマークをエスケープする必要がある。ちなみにシングルクォーテーションはどうなんだろ


### LINE API
- 本来ならWebhookを受け取ったら[署名を検証](https://developers.line.biz/ja/reference/messaging-api/#signature-validation)するけど面倒くさいからしない
- ローカルでデバッグ環境を整えたおかげで開発が爆速になった。ローカルホストに実際と同じPOSTデータを送る。そんでアカウントにプッシュメッセージを飛ばす
- LIFFのURLに追加のパスやパラメータを設定するとリダイレクトされる ＝ 二回ロードされるけど問題なく使用可能
- テキストエリアを可変にさせるには別のタグ使うってのもあり
- Flexの容量をsys.getsizeofを使って知ることはできないか→大きければ警告
- なぜかbuttonではないFlex要素のactionオブジェクトにlabelを指定しても受信できない→dataに指定するしかない

### Webサーバ
- 本番環境はGunicorn（WSGIサーバ）
- Gunicornはデフォルトで？マルチワーカー対応かも（LINEのドキュメントではメッセージは非同期で処理してくださいと書いてある）
- Heroku側の設定でもワーカーの数を指定できたはず

### その他
- データ容量大丈夫か再検証する必要 具体的にいくつのメニューが送れるか タイムもいくつまでか
- メールの文字コードにハマった話
